<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EV Charger Finder</title>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 12px;
      background: radial-gradient(circle at top, #020617 0, #020617 40%, #000 100%);
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .app {
      width: 100%;
      max-width: 600px;
      background: #020617;
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      box-shadow: 0 20px 40px rgba(0,0,0,0.8);
      padding: 16px 14px 18px;
    }

    .header {
      margin-bottom: 14px;
    }

    .header-title {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: #38bdf8;
    }

    .header-sub {
      margin-top: 4px;
      font-size: 13px;
      color: #9ca3af;
      line-height: 1.4;
    }

    .section {
      margin-top: 14px;
      padding: 12px;
      border-radius: 12px;
      background: radial-gradient(circle at top left, #020617, #020617 50%, #020617 100%);
      border: 1px solid rgba(30, 64, 175, 0.6);
    }

    .section-title {
      font-size: 16px;         /* m√°s grande */
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #60a5fa;
      margin-bottom: 8px;
    }

    .hint {
      font-size: 12px;
      color: #9ca3af;
      line-height: 1.4;
    }

    .filters-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      font-size: 12px;
      color: #e5e7eb;
    }

    .filters-row label {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.4);
      background: #020617;
    }

    .filters-row select {
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.4);
      background: #020617;
      color: #e5e7eb;
      font-size: 13px;
    }

    .primary-btn {
      margin-top: 12px;
      width: 100%;
      padding: 12px 14px;
      border-radius: 999px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      background: linear-gradient(135deg, #38bdf8, #22c55e);
      color: #020617;
      cursor: pointer;
      box-shadow: 0 0 18px rgba(56,189,248,0.65);
      transition: transform .15s ease, box-shadow .15s ease, opacity .15s ease;
    }

    .primary-btn:active {
      transform: translateY(1px);
      box-shadow: 0 0 10px rgba(56,189,248,0.5);
      opacity: 0.9;
    }

    .primary-btn:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }

    .stations-list {
      margin-top: 12px;
      font-size: 12px;
      color: #cbd5f5;
    }

    .stations-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #e5e7eb;
    }

    .station-item {
      margin-top: 10px;
      padding: 10px 10px 10px;
      border-radius: 10px;
      background: #020617;
      border: 1px solid rgba(55,65,81,0.9);
    }

    .station-name {
      font-size: 16px;          /* CR√çTICO m√°s grande */
      font-weight: 600;
      color: #f9fafb;
      margin-bottom: 2px;
    }

    .station-distance {
      font-size: 15px;          /* CR√çTICO m√°s grande */
      color: #22c55e;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .station-meta {
      font-size: 12px;
      color: #9ca3af;
      line-height: 1.4;
      margin-bottom: 6px;
    }

    .tag-row {
      margin-top: 4px;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .tag {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      color: #e5e7eb;
    }

    .tag-fast   { border-color: #22c55e; color:#bbf7d0; }
    .tag-tesla  { border-color: #f97316; color:#fed7aa; }
    .tag-chademo{ border-color: #38bdf8; color:#bae6fd; }

    .map-btn {
      display: inline-block;
      margin-top: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #020617;
      font-size: 13px;
      font-weight: 600;
      text-decoration: none;
      letter-spacing: 0.04em;
    }

    .foot {
      margin-top: 16px;
      text-align: center;
      font-size: 11px;
      color: #6b7280;
    }

    .foot span {
      font-weight: 600;
      color: #38bdf8;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    /* Responsivo: celulares normales y peque√±os */
    @media (max-width: 480px) {
      body { padding: 8px; }
      .app { padding: 14px 12px 16px; }
      .header-title { font-size: 19px; }
      .header-sub { font-size: 13px; }
      .section-title { font-size: 16px; }
      .station-name { font-size: 17px; }
      .station-distance { font-size: 16px; }
    }

    @media (max-width: 360px) {
      .header-title { font-size: 18px; }
      .station-name { font-size: 16px; }
      .station-distance { font-size: 15px; }
    }
  </style>
</head>
<body>
<div class="app">
  <header class="header">
    <div class="header-title">EV CHARGER FINDER</div>
    <div class="header-sub">
      Encuentra cargadores cercanos usando tu ubicaci√≥n.  
      Puedes filtrar por cargadores r√°pidos, Tesla y CHAdeMO.
    </div>
  </header>

  <section class="section">
    <div class="section-title">1. Opciones de b√∫squeda</div>
    <p class="hint">
      Acepta el permiso de ubicaci√≥n cuando el navegador lo pida.  
      Luego puedes filtrar por tipo de cargador.
    </p>

    <div class="filters-row">
      <label>
        Radio:
        <select id="radiusSelect">
          <option value="5">5 mi</option>
          <option value="10" selected>10 mi</option>
          <option value="15">15 mi</option>
          <option value="25">25 mi</option>
        </select>
      </label>

      <label>
        <input type="checkbox" id="fastOnly" />
        Solo DC fast
      </label>

      <label>
        <input type="checkbox" id="teslaOnly" />
        Solo Tesla
      </label>

      <label>
        <input type="checkbox" id="chademoOnly" />
        Solo CHAdeMO
      </label>
    </div>

    <button class="primary-btn" id="searchBtn">
      Buscar cargadores cerca de m√≠
    </button>

    <div id="stationsList" class="stations-list">
      <div class="hint">
        Cuando aceptes permisos de ubicaci√≥n y presiones el bot√≥n, ver√°s aqu√≠ los cargadores EV m√°s cercanos.
      </div>
    </div>
  </section>

  <footer class="foot">
    <span>Powered by Ottoleox</span>
    <div>Hecho por un driver EV, para drivers EV.</div>
  </footer>
</div>

<script>
  // üîë Pega aqu√≠ tu API key real del NREL entre comillas
  const NREL_API_KEY = "EKwD8YE3V9ulKI0vR15uwiMtLwm97T36t2vqatwq";

  const searchBtn      = document.getElementById("searchBtn");
  const radiusSelect   = document.getElementById("radiusSelect");
  const fastOnlyCheck  = document.getElementById("fastOnly");
  const teslaOnlyCheck = document.getElementById("teslaOnly");
  const chademoOnlyCheck = document.getElementById("chademoOnly");
  const stationsList   = document.getElementById("stationsList");

  let isSearching = false;

  function setSearching(state) {
    isSearching = state;
    searchBtn.disabled = state;
    searchBtn.textContent = state
      ? "Buscando cargadores..."
      : "Buscar cargadores cerca de m√≠";
  }

  function getUserLocation(onSuccess, onError) {
    if (!navigator.geolocation) {
      onError("Este navegador no soporta geolocalizaci√≥n.");
      return;
    }

    navigator.geolocation.getCurrentPosition(
      (pos) => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        onSuccess({ lat, lon });
      },
      (err) => {
        console.error(err);
        onError("No se pudo obtener tu ubicaci√≥n. Revisa permisos de ubicaci√≥n.");
      },
      {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 60000,
      }
    );
  }

  async function fetchEVStations(lat, lon, radiusMiles) {
    const url =
      "https://developer.nrel.gov/api/alt-fuel-stations/v1/nearest.json" +
      `?api_key=${NREL_API_KEY}` +
      `&latitude=${lat}` +
      `&longitude=${lon}` +
      `&radius=${radiusMiles}` +
      "&fuel_type=ELEC" +
      "&ev_network=all";

    const res = await fetch(url);
    const data = await res.json();

    if (!data.fuel_stations) return [];
    return data.fuel_stations;
  }

  function filterStations(stations) {
    const fastOnly   = fastOnlyCheck.checked;
    const teslaOnly  = teslaOnlyCheck.checked;
    const chademoOnly= chademoOnlyCheck.checked;

    return stations.filter((st) => {
      const connectors = st.ev_connector_types || [];
      const hasTesla   = connectors.includes("TESLA");
      const hasChademo = connectors.includes("CHADEMO");
      const isFast     = (st.ev_dc_fast_num && st.ev_dc_fast_num > 0);

      if (fastOnly && !isFast) return false;
      if (teslaOnly && !hasTesla) return false;
      if (chademoOnly && !hasChademo) return false;

      return true;
    });
  }

  function renderStations(stations) {
    if (!stations.length) {
      stationsList.innerHTML =
        '<div class="hint">No se encontraron estaciones con esos filtros en el radio seleccionado.</div>';
      return;
    }

    let html = '<div class="stations-title">üîå Cargadores cercanos</div>';

    stations.forEach((st) => {
      const dist = st.distance ? st.distance.toFixed(2) : "?";
      const addr = (st.street_address || "") + (st.city ? ", " + st.city : "");
      const connectors = st.ev_connector_types || [];
      const isFast = st.ev_dc_fast_num && st.ev_dc_fast_num > 0;
      const hasTesla = connectors.includes("TESLA");
      const hasChademo = connectors.includes("CHADEMO");

      const tags = [];

      if (isFast) {
        tags.push('<span class="tag tag-fast">DC fast</span>');
      } else if (st.ev_level2_evse_num && st.ev_level2_evse_num > 0) {
        tags.push('<span class="tag">Level 2</span>');
      }

      if (hasTesla) {
        tags.push('<span class="tag tag-tesla">Tesla</span>');
      }
      if (hasChademo) {
        tags.push('<span class="tag tag-chademo">CHAdeMO</span>');
      }
      if (connectors.length > 0) {
        tags.push('<span class="tag">Conectores: ' +
          connectors.join(", ") + "</span>");
      }

      // Bot√≥n "Abrir en mapas" usando lat/lon del cargador
      let mapsUrl = "";
      if (st.latitude && st.longitude) {
        const lat = st.latitude;
        const lon = st.longitude;
        mapsUrl =
          `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
      }

      html += `
        <div class="station-item">
          <div class="station-name">${st.station_name || "Sin nombre"}</div>
          <div class="station-distance">${dist} mi</div>
          <div class="station-meta">${addr}</div>
          ${tags.length ? '<div class="tag-row">' + tags.join("") + '</div>' : ""}
          ${
            mapsUrl
              ? `<a class="map-btn" href="${mapsUrl}" target="_blank" rel="noopener">
                   Abrir en mapas
                 </a>`
              : ""
          }
        </div>
      `;
    });

    stationsList.innerHTML = html;
  }

  searchBtn.addEventListener("click", async () => {
    if (!NREL_API_KEY || NREL_API_KEY === "AQUI_TU_API_KEY_NREL") {
      stationsList.innerHTML =
        '<div class="hint">Falta configurar la API key de NREL en el c√≥digo.</div>';
      return;
    }

    if (isSearching) return;
    setSearching(true);
    stationsList.innerHTML = '<div class="hint">Obteniendo tu ubicaci√≥n‚Ä¶</div>';

    getUserLocation(
      async ({ lat, lon }) => {
        try {
          stationsList.innerHTML = '<div class="hint">Buscando cargadores‚Ä¶</div>';
          const radius = parseFloat(radiusSelect.value) || 10;
          const stations = await fetchEVStations(lat, lon, radius);
          const filtered = filterStations(stations);
          renderStations(filtered);
        } catch (e) {
          console.error(e);
          stationsList.innerHTML =
            '<div class="hint">Ocurri√≥ un error al obtener los cargadores.</div>';
        } finally {
          setSearching(false);
        }
      },
      (msg) => {
        stationsList.innerHTML = `<div class="hint">${msg}</div>`;
        setSearching(false);
      }
    );
  });
</script>
</body>
</html>